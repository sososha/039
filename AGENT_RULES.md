# 🤖 AI 開発ルール

AIエージェントも開発者として参加する前提で、設計の一貫性を保つためのルールを定義します。詳細な仕様・設計は `docs/design/` にあります。必ず仕様を優先してください。

## 📍 1. まず仕様書を参照

正しい挙動は `docs/design/` に定義されています。仕様が唯一の正解であり、コードの挙動より優先します。

## 📍 2. 新しいAPIや挙動の追加は禁止

- 仕様にない public API の追加禁止
- 仕様と異なる動作の実装禁止
- 挙動変更は、先に仕様を編集→理由をPRで記述→設計反映後に実装

## 📍 3. ブランチ運用

| ブランチ | 役割 | ルール |
|---------|------|--------|
| `design-spec-freeze` | 設計保存 | 直接編集禁止（PRのみ） |
| `main` | 実装 | 仕様準拠必須 |
| `feature/*` | 作業 | 試行OK |

基準点タグ: `spec-v0`

## 📍 4. テスト前提で実装

`docs/design/test-plan.md` に従い実装してください（ユニット / HTTP / E2E シナリオ / 必要ならスクショ比較）。

## 📍 5. SceneContext の重要契約

- `render()` は `sync_gpu()` を内部で含む。
- `dirty != empty` で `render()` が呼ばれたら `debug_assert!`。
- `pick()` は状態変更しない（ハイライトは明示的に `set_highlight`）。
- 可視/選択/ハイライトは API 呼び出しでのみ変更。

## 📍 6. 正しさの優先順位

```
仕様 > テスト > 実装
```

実装が間違っている場合、修正すべきなのは実装です。仕様を変えないでください（必要なら先に仕様を更新）。

## 📍 7. 変更時の説明義務

構造的変更を行う場合は、

- 変更理由
- 影響範囲
- 対応する仕様箇所

をコメント/PRで必ず残してください。

---

### ⛔ 注意

`AGENTS.md` は元のプロジェクトルールを保持しています。本ファイルは AI エージェント向けの補足ルールです。双方を矛盾なく守ってください。
